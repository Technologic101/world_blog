(function(d){function c(g,f,h,e){this.element=d(g);this.shouldWrap=f||false;this.wrapper=h||"<div />";this.wrapDelay=e||250;this.originalWidth=this.element.width();this.originalHeight=this.element.height();this.aspectRatio=this.calculateAspectRatio()}c.prototype={element:null,parent:null,originalWidth:0,originalHeight:0,aspectRatio:null,shouldWrap:false,wrapper:"<div />",wrapped:false,wrapDelay:250,wrapDelayId:null,calculateAspectRatio:function(){return this.originalWidth/this.originalHeight},calculateNewWidth:function(){var e=Math.round(this.getParent().width());if(e>this.originalWidth){return this.originalWidth}return e},calculateNewHeight:function(){return Math.round(this.calculateNewWidth()/this.aspectRatio)},onWindowResize:function(){this.resizeElement();this.maybeWrapElement()},resizeElement:function(){var f=this.element,g=this.calculateNewWidth(),e=this.calculateNewHeight();f.attr("width",g).attr("height",e);f.css({width:g,height:e})},maybeWrapElement:function(){if(true===this.shouldWrap){clearTimeout(this.wrapDelayId);this.wrapDelayId=setTimeout(d.proxy(this.onElementWrapDelayTimeout,this),this.wrapDelay)}},onElementWrapDelayTimeout:function(){var e=this.element;if(true===this.wrapped){e.unwrap();this.wrapped=false}else{e.wrap(this.wrapper);this.wrapped=true}},getParent:function(e){var f;if(null===this.parent){if(e){f=d(e)}else{f=this.element.parent()}if(false===f.is("body")&&f.width()>f.parent().width()){return this.getParent(f.parent())}this.parent=f}return this.parent}};function a(e){this.window=e}a.prototype={window:null,oldWidth:0,startingAt:null,fluidElements:[],bind:function(){d(this.window).resize(d.proxy(this.onWindowResize,this))},onWindowResize:function(){var e=d(this.window).width();if(this.startingAt&&(this.oldWidth>=this.startingAt&&e>this.startingAt)){return}if(this.oldWidth!=e){d.each(this.fluidElements,function(f,g){g.onWindowResize()});this.oldWidth=e}}};var b=new a(window);b.bind();d.fn.envoyFluid=function(e){var f=d.extend({startingAt:null,exclude:null,wrap:null,wrapper:"<div />",wrapDelay:250},e);if(f.exclude){f.exclude=d(f.exclude)}if(f.wrap){f.wrap=d(f.wrap)}this.not(f.exclude).each(function(g,i){var j=d(i),h=false;if(f.wrap&&j.is(f.wrap)){h=true}if(f.startingAt){b.startingAt=parseInt(f.startingAt,10)}b.fluidElements.push(new c(i,h,f.wrapper,f.wrapDelay))})}})(jQuery);
